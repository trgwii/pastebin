import { write } from "./utils.ts";
export const unparse = async (data, output) => {
    let bytes = 0;
    if (data instanceof Uint8Array) {
        bytes += await write(output, 0);
        bytes += await write(output, BigInt(data.byteLength));
        await Deno.writeAll(output, data);
        bytes += data.byteLength;
    }
    else {
        bytes += await write(output, 1);
        bytes += await write(output, BigInt(Object.keys(data).length));
        for (const [name, bundle] of Object.entries(data)) {
            const nameData = new TextEncoder().encode(name);
            bytes += await write(output, nameData.byteLength);
            await Deno.writeAll(output, nameData);
            bytes += nameData.byteLength;
            bytes += await unparse(bundle, output);
        }
    }
    return bytes;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5wYXJzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVucGFyc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFlBQVksQ0FBQztBQUduQyxNQUFNLENBQUMsTUFBTSxPQUFPLEdBQUcsS0FBSyxFQUFFLElBQVksRUFBRSxNQUFtQixFQUFFLEVBQUU7SUFDakUsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ2QsSUFBSSxJQUFJLFlBQVksVUFBVSxFQUFFO1FBQzlCLEtBQUssSUFBSSxNQUFNLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDaEMsS0FBSyxJQUFJLE1BQU0sS0FBSyxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7UUFDdEQsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNsQyxLQUFLLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQztLQUMxQjtTQUFNO1FBQ0wsS0FBSyxJQUFJLE1BQU0sS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNoQyxLQUFLLElBQUksTUFBTSxLQUFLLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDL0QsS0FBSyxNQUFNLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDakQsTUFBTSxRQUFRLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDaEQsS0FBSyxJQUFJLE1BQU0sS0FBSyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDbEQsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztZQUN0QyxLQUFLLElBQUksUUFBUSxDQUFDLFVBQVUsQ0FBQztZQUM3QixLQUFLLElBQUksTUFBTSxPQUFPLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ3hDO0tBQ0Y7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUMsQ0FBQyJ9